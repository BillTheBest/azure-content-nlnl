<properties 
	pageTitle="DocumentDB 中的一致性層級" 
	description="DocumentDB 對於相關效能等級有 4 個一致性等級，可便於應用程式開發人員針對一致性、可用性和延遲三方面進行可預測的取捨評估。" 
	services="documentdb" 
	authors="mimig1" 
	manager="jhubbard" 
	editor="cgronlun" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/05/2015" 
	ms.author="mimig"/>

#DocumentDB 中的一致性層級
開發人員通常難以在「增強式」和「最終」這兩種極端的一致性層級之中做出抉擇。但事實上，在這兩種極端選項之間還有多個一致性層級可供選擇。在大部分的真實案例中，應用程式都因為能夠細膩取捨一致性、可用性與延遲而獲得不少好處。DocumentDB 提供四個定義完善的一致性層級與相關聯的效能層級。因此，應用程式開發人員得以在預測範圍內針對一致性、可用性和延遲做出適當取捨。  
 
所有系統資源 (包括資料庫帳戶、資料庫、集合、使用者和權限) 在讀取和查詢方面始終具有極大程度的一致性。一致性層級只適用於使用者定義的資源。針對使用者定義的資源 (包括文件、附件、預存程序、觸發程序和 UDF) 所進行的查詢和讀取作業，DocumentDB 提供四個不同的一致性層級： 

 - 增強式
 - 界限-陳舊 
 - 工作階段
 - 最終 

這些細微且定義完善的一致性層級可讓您在一致性、可用性與效能三者間做出合理取捨。這些一致性層級受到可預測的效能層級的支援，可確保應用程式有一致的結果。   

##一致性層級
您可以設定資料庫帳戶的「預設一致性層級」，以套用至資料庫帳戶底下 (所有資料庫) 的所有集合。所有對使用者定義的資源發出的讀取和查詢，預設都會使用資料庫帳戶上所指定的預設一致性層級。不過，您可以指定 [x-ms-consistency-level] 要求標頭，來降低特定讀取/查詢要求的一致性層級。DocumentDB 的複寫通訊協定支援四種類型的一致性層級，下面有這些層級的簡短說明。 

>[AZURE.NOTE] 之後的版本預計會支援對個別集合覆寫預設的一致性層級。  

**增強式**：「增強式」一致性保證只有在複本的多數仲裁持久認可寫入之後，才會顯示寫入。寫入不是會被主要和次要仲裁同步地持久認可，就是會被中止。讀取的認可一律是交由多數讀取仲裁來負責；用戶端絕不會看到未認可或不完整的寫入，而且一律保證會讀取最新認可的寫入。   
 
「增強式」一致性可保證資料絕對一致，但是其讀取和寫入效能最差。  

**界限-陳舊**：「界限-陳舊」一致性可保證寫入傳播的總體順序，但是讀取時最多可能會比寫入時延遲千倍 (K) 的程度。讀取的認可一律是交由複本的多數仲裁來負責。讀取要求的回應可指出其相對新鮮度 (以 K 來表示)。  

「界限-陳舊」的讀取一致性行為更加容易預測，且寫入延遲最低。因為讀取的認可是由多數仲裁負責，所以系統提供的讀取延遲不是最低的。    

**工作階段**：與「增強式」和「界限-陳舊」一致性層級所提供的全域一致性模型不同，「工作階段」一致性是專為特定用戶端工作階段而設計。工作階段一致性通常就已足夠，因為它提供有保證的單純讀取、寫入，以及讀取您自己的寫入的能力。工作階段一致性的讀取要求發出對象，是可以提供用戶端所要求版本 (工作階段 Cookie 的一部分) 的複本。  

「工作階段一致性」層級為工作階段提供可預測的讀取資料一致性，且寫入延遲最低。在極少數的情況下，讀取延遲也很低 (這為例外)，此時讀取會由單一複本提供。  

**最終**：「最終」一致性是最差的一致性形式，在經過一段時間之後，用戶端可能會取得比之前所看到的值還要舊的值。之後如果沒有再收到任何寫入，群組內的複本最後會只剩一個。讀取要求是由任何次要索引提供。  

「最終一致性」提供最差的讀取一致性，但是讀取和寫入的延遲皆是最低。 

##查詢一致性
根據預設，使用者定義的資源的查詢一致性層級會與讀取相同。每次在集合中插入、取代或刪除文件時，預設會同步更新索引。這個行為讓查詢能夠使用與文件的讀取相同的一致性層級。雖然 DocumentDB 的寫入已經過最佳化處理，並支援持續的文件寫入數量以及同步索引維護和提供一致的查詢，但是您還是可以設定特定集合，讓集合的索引更新速度變慢。讓索引速度變慢可提升寫入效能，而且適合用於工作量主要是進行大量讀取的大量擷取案例。  

索引模式|	讀取|	查詢  
-------------|-------|---------
一致 (預設)|	有「增強式」、「界限-陳舊」、「工作階段」或「最終」可供選取|	有「增強式」、「界限-陳舊」、「工作階段」或「最終」可供選取|
緩慢|	有「增強式」、「界限-陳舊」、「工作階段」或「最終」可供選取|	最終  

和讀取要求相同，您可以指定 [x-ms-consistency-level] 要求標頭，來降低特定查詢要求的一致性層級。  

##參考
-	Doug Terry。透過棒球解釋的複寫資料一致性。   
[http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf](http://research.microsoft.com/pubs/157411/ConsistencyAndBaseballReport.pdf)
-	Doug Terry。弱式一致複寫資料的工作階段保證。   
[http://dl.acm.org/citation.cfm?id=383631](http://dl.acm.org/citation.cfm?id=383631)
-	Daniel Abadi。現代分散式資料庫系統設計的一致性取捨：CAP 是唯一的重點。   
[http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html](http://computer.org/csdl/mags/co/2012/02/mco2012020037-abs.html) 
-	Peter Bailis、Shivaram Venkataraman、Michael J. Franklin、Joseph M. Hellerstein、Ion Stoica。實際部分仲裁的機率界限-陳舊 (PBS)。   
[http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf](http://vldb.org/pvldb/vol5/p776_peterbailis_vldb2012.pdf)
-	Werner Vogels。再論最終一致。    
[http://allthingsdistributed.com/2008/12/eventually_consistent.html](http://allthingsdistributed.com/2008/12/eventually_consistent.html)

<!--HONumber=49--> 