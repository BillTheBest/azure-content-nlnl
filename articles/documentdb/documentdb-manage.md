<properties 
	pageTitle="管理 DocumentDB 的容量和效能 | Azure" 
	description="了解如何彈性調整 DocumentDB，以符合應用程式的容量需求。" 
	services="documentdb" 
	authors="mimig1, johnfmacintyre" 
	manager="jhubbard" 
	editor="cgronlun" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/17/2015" 
	ms.author="mimig"/>

#管理 DocumentDB 的容量和效能
DocumentDB 是受到完整管理、可擴充的文件導向 NoSQL 資料庫服務。有了 DocumentDB，您就不需要租用虛擬機器、部署軟體、監視資料庫或擔心災害復原。Microsoft 工程師會負責操作並持續監視 DocumentDB，提供世界級的可用性、效能和資料保護能力。  

若要開始使用 DocumentDB，請先透過 [Microsoft Azure 預覽管理入口網站](https://portal.azure.com/)建立資料庫帳戶。DocumentDB 是以一定容量單位 (CU) 數目的 固態硬碟 (SSD) 型儲存體和輸送量來提供，且此容量單位可以堆疊。您可以彈性調整 DocumentDB，以符合應用程式的效能和儲存需求。 

每個容量單位都附有用來儲存文件資料的集合配額、已佈建的文件儲存體和已佈建的輸送量 (每秒的要求單位數)。如果應用程式的容量需求改變，您可以在資料庫帳戶中擴大或縮小佈建的容量大小。資料庫帳戶下所佈建的容量，可用於帳戶中既有或新建的所有資料庫和集合。

> [AZURE.NOTE] 每一個集合可以將儲存體和輸送量擴充到支援的最大[限制](documentdb-limits.md)。輸送量會平均分散到所有集合，每個集合最高達最大限制。

當您的應用程式超過一個或多個集合的效能等級時，要求將會依每個集合為基礎降低。這表示某些應用程式的要求可能會成功，而其他的可能受到節流控制。

##<a name="DBaccount"></a>資料庫帳戶和管理資源
身為 Azure 訂閱者，您可以佈建一個或多個 DocumentDB 資料庫帳戶。每個資料庫帳戶都附有系統管理資源配額，包括資料庫、使用者和權限。這些資源受限於[限制和配額](documentdb-limits.md)。如果您需要其他管理資源，請連絡支援。   

##<a name="DBstorage"></a> 文件儲存體數量沒有限制的資料庫
單一 DocumentDB 資料庫可以包含幾乎不限數量的文件儲存體 (依集合分割)。集合構成其內含文件的交易網域。DocumentDB 資料庫預設是具有彈性的 - 範圍從幾 GB 到可能數 TB 的 SSD 型文件儲存體和佈建的輸送量。不同於傳統 RDBMS 資料庫，DocumentDB 中的資料庫不侷限在單一機器內。   

利用 DocumentDB，您可以隨著應用程式的規模需求成長，建立更多的集合及/或資料庫。的確，Microsoft 中的各種第一方應用程式都是依消費者規模來使用 DocumentDB，建立極大的 DocumentDB 資料庫，每個資料庫各包含數千個具有好幾 TB 文件儲存體的集合。您可以新增或移除集合來擴充或縮減資料庫，以配合您的應用程式規模需求。您可以依據供應能力以及您購買的容量單位，在資料庫中建立任何數目的集合。為您佈建的 SSD 型儲存體和輸送量可以分散到資料庫帳戶中的資料庫底下的所有集合中。 

##<a name="DBCollections"></a>資料庫集合
每個 DocumentDB 資料庫都可以包含一個或多個集合。集合可為文件儲存體和查詢執行提供適用範圍。集合也是其內含之所有文件的交易網域。您可以建立任何數目的集合，以符合應用程式的規模需求。若要建立集合，您需要先購買一個或多個容量單位 (CU)。每個容量單位都有集合配額，如果您達到帳戶的集合配額，可以另外購買容量單位。  

>[AZURE.NOTE] 每個集合支援最多 10 GB 文件資料的儲存體。 

##<a name="ProvStorage"></a>以容量單位形式佈建的儲存體和輸送量
您可以用容量單位 (CU) 的形式佈建一定單位量的 SSD 型文件儲存體和輸送量，且此單位可以堆疊。您可以購買更多容量單位，依據可預測的效能彈性調整 DocumentDB，以符合應用程式的讀取規模、儲存體和輸送量需求。  
 
每個 CU 都附有 3 個彈性集合、10GB 的 SSD 型已佈建文件儲存體，以及相當於 2000 個要求單位 (RU) 的佈建輸送量。與 CU 相關聯的佈建儲存體和輸送量容量，會分配到您建立的所有 DocumentDB 集合。   

##<a name="ProvThroughput"></a>要求單位和資料庫作業
DocumentDB 可供進行許多的資料庫作業，包括使用 UDF、預存程序和觸發程序進行關聯式和階層式查詢，而這些作業全都是對資料庫集合內的文件來進行。與上述各項作業相關聯的處理成本，會因為完成作業所需的 CPU、IO 和記憶體而不同。您不需要考慮和管理硬體資源，您可以將要求單位 (RU) 想成是執行各種資料庫作業以及服務應用程式要求時所需的資源數量。

系統會依據您購買的容量單位數目，為每個資料庫帳戶佈建要求單位。在 DocumentDB 的預覽中，建立的每個集合都會獲指派要求單位限制。配置的計算方式是平均將所購買容量單位的所有要求單位配置為帳戶內所建立的集合數目。例如，針對購買 2 個容量單位並建立 4 個集合的帳戶，每個集合都會獲指派 2 個容量單位 x 2,000 個要求單位 / 4 個集合，即一個集合配置 1,000 個要求單位。Azure DocumentDB 公開上市時，服務不再將要求單位分散到帳戶內的集合。將會根據效能層級購買要求單位，並將其指派給特定集合。如需詳細資訊，請參閱 [DocumentDB 效能層級](documentdb-performance-levels.md)。 

>[AZURE.NOTE] 在 Azure DocumentDB 的預覽期間，不能將 2,000 個以上的要求單位配置給每個集合。 

要求單位消耗量是以每秒的速率來計算。如果應用程式的速率超過為其帳戶佈建的要求單位速率，便會受到節流控制，直到該速率降到每個集合的預留層級以下。如果應用程式需要較高層級的輸送量，您可以另外購買容量單位。

要求單位是要求處理成本的標準化量值。單一要求單位代表讀取由 10 個唯一屬性值所組成的單一 1KB JSON 文件所需的處理容量。要求單位費用會假設一致性層級設定為預設「工作階段」，並且自動編製所有文件的索引。插入、取代或刪除相同文件的要求會耗用服務的更多處理，因此耗用更多的要求單位。服務的每個要求回應都會包括自訂標頭 (x-ms-request-charge)，以測量要求所耗用的要求單位。此標頭也可以透過 SDK 進行存取。在 .Net SDK 中，RequestCharge 是 ResourceResponse 物件的屬性。

有數個因素會影響針對 DocumentDB 資料庫帳戶作業所耗用的要求單位。這些因素包括：

- 文件大小 - 文件大小增加時，也會增加讀取或寫入資料所耗用的單位。
- 屬性計數 - 假設預設會編製所有屬性的索引，撰寫文件所耗用的單位將會隨著屬性計數增加而增加
- 資料一致性 - 使用資料一致性層級「增強式」或「界限-陳舊」時，將會使用其他單位來讀取文件
- 索引的屬性 - 每個集合上的索引原則會判定預設要編製索引的屬性。您可以限制索引的屬性數目，來減少要求單位耗用量
- 文件編製索引 - 預設會自動編製每份文件的索引，如果您選擇不要編製一些文件的索引，則會耗用較少的要求單位

查詢、預存程序和觸發程序會根據所執行作業的複雜度來使用要求單位。開發應用程式時，請檢查要求費用標頭，進一步了解每項作業如何耗用要求單位容量。

##<a name="Collections"></a>集合和佈建的輸送量
資料庫帳戶的佈建輸送量會統一配置在所有集合中，單一集合的最高輸送量取決於輸送量層級上限 (要求單位)。例如，如果您購買單一容量單位，並建立單一集合，則該集合可以使用 CU 的所有佈建輸送量。如果再建立一個集合，佈建輸送量將會平均配置，每個集合各會獲得所有佈建輸送量的一半。  

##<a name="Consistency"></a>一致性層級和輸送量的選擇
預設一致性層級的選擇會影響輸送量和延遲。您可以用程式設計方式或透過 Azure 入口網站來設定預設的一致性層級。您也可以覆寫個別要求的一致性層級。依預設，一致性層級是一種工作階段，可提供單純的讀取/寫入以及讀取您的寫入的保證。工作階段一致性對於以使用者為中心的應用程式非常有用，並且可以讓您在取捨一致性與效能時找到最佳平衡點。    

如需在 Azure 預覽管理入口網站上變更一致性層級的指示，請參閱＜作法：管理 DocumentDB 一致性設定 (位於[如何管理 DocumentDB 帳戶](documentdb-manage-account.md)中)。

##<a name="IndexOverhead"></a>佈建的文件儲存體和索引額外負荷
每購買一個 CU，您的帳戶就會再佈建 10GB 的 SSD 型文件儲存體。10GB 的文件儲存體包含文件加上用於索引的儲存體。預設會將 DocumentDB 集合設定為自動將所有文件編製索引，而不明確要求任何次要索引或結構描述。以使用 DocumentDB 的消費者規模第一方應用程式做為標準來計算生產用量的話，一般索引額外負荷介於 2-20% 之間。DocumentDB 所使用的索引技術可確保無論屬性值為何，索引額外負荷都不會超過使用預設值之文件大小的 80% 以上。  

依預設，DocumentDB 會自動將所有文件編製索引。不過，如果您想要微調索引額外負荷，您可以選擇排除一些文件，不要在插入或取代文件時對這些文件編製索引。您可以設定 DocumentDB 集合，排除對集合中的所有文件編製索引。您也可以設定 DocumentDB 集合，選擇只將 JSON 文件中具有萬用字元的一些屬性或路徑編製索引。排除屬性或文件也可以改善寫入輸送量，也就是說，您會耗用較少的要求單位。   
 
##<a name="NextSteps"></a>後續步驟
如需在 Azure 預覽入口網站中管理您的 DocumentDB 帳戶的指示，請參閱＜作法：管理 DocumentDB 一致性設定 (位於[如何管理 DocumentDB 帳戶](documentdb-manage-account.md)中)。

如需在 Azure 預覽入口網站上監視效能等級的指示，請參閱[監視 DocumentDB 帳戶](documentdb-monitor-accounts.md)。

<!--HONumber=49--> 