<properties 
   pageTitle="StorSimple 虛擬裝置"
   description="了解如何建立、設定、部署和管理執行 Update 1.0 的 StorSimple 虛擬裝置。"
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carolz"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="05/27/2015"
   ms.author="alkohli" />

# StorSimple 虛擬裝置

[AZURE.INCLUDE [storsimple-version-selector-sva](../../includes/storsimple-version-selector-sva.md)]

##概觀
StorSimple 虛擬裝置是 Microsoft Azure StorSimple 解決方案提供的另一項功能。StorSimple 虛擬裝置會在 Microsoft Azure 虛擬網路中的虛擬機器上執行，而您可以使用它來備份和複製主機上的資料。下列主題將協助您了解、設定和使用 StorSimple 虛擬裝置。



- 虛擬裝置與實體裝置的差異

- 使用虛擬裝置的安全性考量

- 虛擬裝置的必要條件

- 建立和設定虛擬裝置

- 使用虛擬裝置

- 容錯移轉至虛擬裝置

- 關閉或刪除虛擬裝置

本教學課程適用於所有執行 Update 1 的 StorSimple 虛擬裝置。

## 虛擬裝置與實體裝置的差異

StorSimple 虛擬裝置是軟體形式的 StorSimple，在 Microsoft Azure 虛擬機器中的單一節點上執行。虛擬裝置支援無法使用實體裝置時的災害復原案例，適合在雲端裝置和測試案例中使用。

### 與實體裝置的差異

以下是 StorSimple 虛擬裝置和實體 StorSimple 裝置之間的一些主要差異：

- 虛擬裝置只有一個網路介面：DATA 0。實體裝置有六個網路介面：DATA 0 到 DATA 5。
- 虛擬裝置是在設定步驟期間註冊，而不是以個別的工作來註冊。
- 無法從虛擬裝置重新產生服務資料加密金鑰。在金鑰變換期間，您會在實體裝置上重新產生金鑰，然後以新的金鑰更新虛擬裝置。
- 如果需要將更新套用到虛擬裝置，則會發生一些停機情況，但實體裝置並不會。

## 使用虛擬裝置的安全性考量

使用 StorSimple 虛擬裝置時，請留意下列安全性考量：

- 虛擬裝置會透過您的 Microsoft Azure 訂用帳戶受到保護。這表示，如果您使用的是虛擬裝置，而您的 Azure 訂用帳戶遭到洩漏，則儲存在虛擬裝置上的資料也會受到影響。

- 用來對儲存在 Azure StorSimple 中的資料加密的憑證公開金鑰，會安全地在 Microsoft Azure 管理入口網站中供人使用，而私密金鑰則會保留在 StorSimple 裝置中。在 StorSimple 虛擬裝置上，公開和私密金鑰都會儲存於 Azure 中。

- 虛擬裝置會裝載於 Microsoft Azure 資料中心。


## 虛擬裝置的必要條件

下列各節將協助您做好準備來使用 StorSimple 虛擬裝置。

### Azure 需求

佈建虛擬裝置之前，您需要在 Azure 環境中做好下列準備：

- 針對虛擬裝置，[在 Azure 中設定虛擬網路](https://msdn.microsoft.com/library/azure/jj156074.aspx)。 
- 您可以使用 Azure 提供的預設 DNS 伺服器，而不必指定您自己的 DNS 伺服器名稱。 
- 點對站台及站台對站台都是選用的，但並非必要。如有需要，您可以針對更進階的案例設定這些選項。 

>[AZURE.IMPORTANT]**請確定虛擬網路與您即將與虛擬裝置搭配使用的雲端儲存體帳戶位於相同區域中。**

- 在虛擬網路中建立 [Azure 虛擬機器](https://msdn.microsoft.com/library/azure/jj156003.aspx) (主機伺服器)。這些伺服器必須符合下列需求： 							
	- 是已安裝 iSCSI 啟動器軟體的 Windows 或 Linux VM
	- 正在虛擬裝置所在的相同虛擬網路中執行
	- 能夠透過虛擬裝置的內部 IP 位址連接到虛擬裝置的 iSCSI 目標

- 確定您已在相同虛擬網路上設定 iSCSI 和雲端流量的支援。

### StorSimple 需求

建立虛擬裝置之前，對 Azure StorSimple 服務進行下列更新：


- 針對要做為虛擬裝置之主機伺服器的 VM，新增[存取控制記錄](https://msdn.microsoft.com/library/1747f56e-858a-4cfe-a020-949d7db23b8b#sec02)。

- 確定您在虛擬裝置所在的相同區域中擁有[儲存體帳戶](storsimple-manage-storage-accounts.md)。若儲存體帳戶位於不同區域，可能導致效能不佳。

- 確定您用於建立虛擬裝置的儲存體帳戶與用於資料的儲存體帳戶不同。使用相同的儲存體帳戶可能導致效能不佳。

開始之前，請確定您擁有下列資訊：


- 您擁有的 Azure 管理入口網站帳戶具有存取認證。

- 您擁有 Azure 儲存體帳戶存取認證。

- 您擁有實體裝置中服務資料加密金鑰的複本。

- 您擁有每一個磁碟區容器的雲端儲存體加密金鑰複本。


## 建立和設定虛擬裝置

執行這些程序之前，請確定您符合[虛擬裝置的必要條件](#Prerequisites-for-the-virtual-device)。

完成這些程序之後，您就準備好可以[使用虛擬裝置](#Work-with-the-StorSimple-virtual-device)。

### 建立虛擬網路

當您建立虛擬網路、設定 StorSimple Manager 服務，以及向該服務註冊實體 StorSimple 裝置之後，就可以使用下列步驟來建立 StorSimple 虛擬裝置。

執行下列步驟來建立 StorSimple 虛擬裝置



1.  在管理入口網站中，移至 **StorSimple Manager** 服務。

- 移至 [裝置] 頁面。按一下 [裝置] 頁面底部的 [**建立虛擬裝置**]。

- 在 [建立虛擬裝置] 對話方塊中，指定下列資訊：

	a.**名稱** - 虛擬裝置的唯一名稱。


	b.**版本** - 選擇虛擬裝置的版本。如果您利用此服務註冊 Update 1 實體裝置，就不會有此選項。只有在您利用此服務註冊更新前 1 和 Update 1 的組合時，此欄位才會出現。給定版本的虛擬裝置會判斷您可以容錯移轉或從其複製的實體裝置，請務必建立適當版本的虛擬裝置。選取：

	- 如果您利用 GA 版本或 Update 0.1 到 0.3 從實體裝置容錯移轉或 DR，則為 Update 0.3 版。 
	- 如果您利用 Update 1 從實體裝置容錯移轉或複製，則為 Update 1 版。 

 
	b.**虛擬網路** - 要與此虛擬裝置一起使用的虛擬網路名稱。

	c.**子網路** - 虛擬網路上與虛擬裝置一起使用的子網路。

	d.**虛擬裝置建立的儲存體帳戶** - 在佈建期間用來存放虛擬裝置映像的儲存體帳戶。此儲存體帳戶應該與虛擬裝置和虛擬網路位於相同的區域中。不應讓實體裝置或虛擬裝置用它來儲存資料。根據預設，將基於此用途建立新的儲存體帳戶。不過，如果您知道已經擁有適合此用途的儲存體帳戶，則可從清單中選取該帳戶。
	

>[AZURE.NOTE]虛擬裝置只能使用 Azure 儲存體帳戶。StorSimple 虛擬裝置不支援其他雲端服務提供者，例如 Amazon、HP 和 OpenStack (皆受實體裝置支援)。
	
- 按一下勾號，表示您了解虛擬裝置上儲存的資料將裝載於 Microsoft 資料中心。若您只使用實體裝置，加密金鑰就會與裝置放在一起。因此，Microsoft 無法將它解密。當您使用虛擬裝置時，加密金鑰和解密金鑰都會儲存於 Microsoft Azure 中。如需詳細資訊，請參閱[使用虛擬裝置的安全性考量](#security-considerations-for-using-a-virtual-device)。

### 設定和註冊虛擬裝置

開始此程序之前，請確定您擁有服務資料加密金鑰的複本。服務資料加密金鑰已在您設定第一個 StorSimple 裝置時建立，且系統已指示您將它儲存在安全的位置。如果您沒有服務資料加密金鑰的複本，就必須連絡 Microsoft 支援服務以尋求協助。

執行下列步驟來設定和註冊 StorSimple 虛擬裝置。


1. 選取 [StorSimple 虛擬裝置] 做為您的裝置，然後按兩下該裝置來存取 [快速入門]。

- 按一下 [完成裝置設定]。這會啟動 [設定裝置] 精靈。

- 在提供的空白處輸入 [服務資料加密金鑰]。

- 按一下勾號來完成虛擬裝置的初始設定和註冊。裝置系統管理員密碼已預先設定預設值，必須在註冊裝置之後加以變更。

### 修改裝置組態設定

下節說明需要為 StorSimple 虛擬裝置設定的裝置組態設定。

#### 設定 CHAP 起始端

此參數包含您的虛擬裝置 (目標) 預期從嘗試存取磁碟區的起始端 (伺服器) 收到的認證。在這個驗證過程中，起始端將提供 CHAP 使用者名稱和 CHAP 密碼，以便向您的裝置識別其身分。

#### 設定 CHAP 目標

此參數包含具有 CHAP 功能的起始端要求相互或雙向驗證時，您的虛擬裝置所使用的認證。在這個驗證程序中，您的虛擬裝置將使用反向 CHAP 使用者名稱和反向 CHAP 密碼，向起始端識別其身分。請注意，CHAP 目標設定為全域設定。套用這些項目時，與虛擬裝置連接的所有磁碟區都將使用 CHAP 驗證。

#### 設定 StorSimple Snapshot Manager

StorSimple Snapshot Manager 軟體位於您的 Windows 主機上，而且可讓系統管理員以本機和雲端快照的形式管理 StorSimple 裝置的備份。

>[AZURE.NOTE]**對虛擬裝置而言，您的 Windows 主機就是 Azure VM。**

當您在 StorSimple Snapshot Manager 中設定裝置時，系統將提示您提供 StorSimple 裝置 IP 位址和密碼來驗證您的儲存裝置。

將 StorSimple Snapshot Manager 和您的 StorSimple 虛擬裝置搭配使用時，執行下列步驟來設定它。

1. 在虛擬裝置上，移至 [裝置] > [設定]。

- 向下捲動至 [Snapshot Manager] 區段。輸入 14 或 15 個字元的密碼。請確定密碼包含大寫、小寫、數字和特殊字元等 4 種項目中的 3 種。

- 確認密碼。

- 按一下頁面底部的 [儲存]。

StorSimple Snapshot Manager 密碼現在已更新，可在驗證 Windows 主機時使用。

#### 設定裝置系統管理員密碼

當您使用 Windows PowerShell 介面來存取虛擬裝置時，需要輸入裝置系統管理員密碼。為了確保資料的安全性，您必須變更此密碼，才能使用虛擬裝置。

執行下列步驟來設定 StorSimple 虛擬裝置的裝置系統管理員密碼。

1. 在虛擬裝置上，移至 [裝置] > [設定]。
 
1. 向下捲動至 [裝置系統管理員密碼] 區段。提供含有 8 到 15 個字元的系統管理員密碼。密碼必須包含大寫、小寫、數字和特殊字元等 4 種項目中的 3 種。

1. 確認密碼。
 
1. 按一下頁面底部的 [儲存]。

現在應該已更新裝置系統管理員密碼。您將使用此修改過的密碼來存取虛擬裝置上的 Windows PowerShell 介面。

#### 設定遠端管理 

預設不會啟用透過 Windows PowerShell 介面遠端存取您的虛擬裝置。您需要先在虛擬裝置上啟用遠端管理，然後在將用來存取虛擬裝置的用戶端上啟用它。

您可以選擇透過 HTTP 或 HTTPS 來連接。基於安全理由，建議您使用 HTTPS 並搭配自我簽署憑證來連接到虛擬裝置。

執行下列步驟來設定 StorSimple 虛擬裝置的遠端管理。


1. 在虛擬裝置上，移至 [裝置] > [設定]。

2. 向下捲動至 [遠端管理] 區段。

3. 將 [啟用遠端管理] 設為 [是]。

4. 您現在可以選擇使用 HTTP 來連接。預設是透過 HTTPS 來連接。只有受信任的網路上才接受透過 HTTP 來連接。

5. 按一下 [下載遠端管理憑證] 來下載遠端管理憑證。您將指定儲存此檔案的位置。然後，此憑證需要安裝於您將用來連接到虛擬裝置的用戶端或主機電腦上。

6. 按一下頁面底部的 [儲存]。


## 使用 StorSimple 虛擬裝置

現在您已建立並設定 StorSimple 虛擬裝置，就已準備好開始使用它。您可以在虛擬裝置上使用磁碟區容器、磁碟區及備份原則，正如同您在實體 StorSimple 裝置 上所做的一樣。唯一的差異在於，您必須確定會從裝置清單中選取虛擬裝置。如需相關工作的指示，請參閱下列各節：


- [磁碟區容器](storsimple-manage-volume-containers.md)

- [磁碟區](storsimple-manage-volumes.md)

- [備份原則](storsimple-manage-backup-policies.md)

下列各節將討論您在使用虛擬裝置時將遇到的一些差異。

### 維護 StorSimple 虛擬裝置

由於它是純軟體裝置，相較於實體裝置的維護，虛擬裝置的維護可說是最基本的。您有下列選擇：

- **軟體更新** - 您可以檢視上次更新軟體的日期，以及任何更新狀態訊息。如果想要檢查是否有新的更新，可以使用頁面底部的 [**掃描更新**] 按鈕來執行手動掃描。如果有可用更新，請按一下 [**安裝更新**] 加以安裝。因為虛擬裝置上只有單一介面，這表示在套用更新時將造成服務些微中斷。虛擬裝置將關閉並重新啟動 (如有必要)，以套用任何已發行的更新。
- **支援封裝** - 您可以建立並上傳支援封裝，以協助 Microsoft 支援服務為您的虛擬裝置問題進行疑難排解。  


### 虛擬裝置的儲存體帳戶

儲存體帳戶是建立來供 StorSimple Manager 服務、虛擬裝置和實體裝置使用。當您建立儲存體帳戶時，建議您在易記名稱中使用區域識別碼，有助於確保所有系統元件的區域都是一致的。在虛擬裝置中，所有元件都必須位於相同區域中，以防止發生效能問題。

### 停用 StorSimple 虛擬裝置

停用虛擬裝置，將刪除佈建它時所建立的 VM 和資源。停用虛擬裝置之後，就無法將它還原為先前的狀態。停用虛擬裝置之前，請確實停止或刪除其依存的用戶端和主機。

停用虛擬裝置會導致下列動作：

- 移除虛擬裝置。

- 移除為虛擬裝置建立的 OSDisk 和資料磁碟。

- 保留在佈建期間建立的裝載服務和虛擬網路。如果您不使用它們，就應該手動加以刪除。

- 保留為虛擬裝置建立的雲端快照。

只要裝置在 StorSimple Manager 服務頁面上顯示為已停用，您就能從 StorSimple Manager 服務裝置清單中刪除該虛擬裝置。

### 遠端存取 StorSimple 虛擬裝置

當您在 StorSimple 裝置設定頁面上啟用虛擬裝置之後，就可以使用 Windows PowerShell 遠端處理功能，從相同虛擬網路內部的另一部虛擬機器連接到虛擬裝置；例如，您可以從已設定且用來連接 iSCSI 的主機 VM 進行連接。在大部分的部署中，您應該都已開啟公用端點來存取您可用來存取虛擬裝置的主機 VM。

>[AZURE.WARNING]**為了加強安全性，強烈建議您在連接到端點時應使用 HTTPS，並且在完成 PowerShell 遠端工作階段之後刪除端點。**

您應遵循[使用 Windows PowerShell 從遠端連接](https://msdn.microsoft.com/library/dn772393.aspx)中的程序，來設定虛擬裝置的遠端處理功能。

不過，如果您要從虛擬網路或 Microsoft Azure 環境以外的另一部電腦直接連接到虛擬裝置，就必須依照下列程序中的說明來建立其他端點。

執行下列步驟，在虛擬裝置上建立公用端點。

1. 登入管理入口網站。

- 按一下 [虛擬機器]，然後選取想要用來做為虛擬裝置的虛擬機器。

- 按一下 [端點]。[端點] 頁面會列出虛擬機器的所有端點。

- 按一下 [新增]。[新增端點] 對話方塊隨即出現。按一下箭頭以繼續。

- 針對 [名稱]，為端點輸入下列名稱：**WinRMHttps**。

- 將 [TCP] 指定為 [通訊協定]。

- 針對 [公用連接埠]，輸入要用於連線的連接埠號碼。

- 針對 [私人連接埠]，輸入 [5986]。

- 按一下核取記號以建立端點。

建立端點之後，您可以檢視其詳細資料，以確認公用虛擬 IP (VIP) 位址。請記下此位址。

建議您從相同虛擬網路內部的另一部虛擬機器進行連接，因為此做法可將虛擬網路上的公用端點數降到最低。使用此方法時，您只需透過遠端桌面工作階段連接到虛擬機器，然後依照您在區域網路上設定任何其他 Windows 用戶端的方式來設定該虛擬機器即可。您不需附加公用連接埠號碼，因為該連接埠將會是已知的。

### 停止和重新啟動

不同於實體 StorSimple 裝置，在 StorSimple 虛擬裝置上並沒有開啟電源或關閉電源按鈕可供使用。但是，有時您可能需要停止並重新啟動虛擬裝置。例如，有些更新可能必須在 VM 重新啟動後才能完成更新程序。若要啟動、停止和重新啟動虛擬裝置，最簡單的方式是使用虛擬機器管理主控台。

當您檢視管理主控台時，虛擬裝置狀態是 [執行中]，因為它在建立之後會預設為啟動狀態。您隨時都能停止並重新啟動虛擬機器。

若要停止虛擬裝置，請按一下其名稱，然後按一下 [關機]。當虛擬裝置正在關閉期間，其狀態會是 [正在停止]。當虛擬裝置停止之後，其狀態會是 [已停止]。

若虛擬裝置正在執行，但您想將它重新啟動，請按一下其名稱，然後按一下 [重新啟動]。當虛擬裝置正在重新啟動期間，其狀態會是 [正在重新啟動]。若虛擬裝置已可供您使用，其狀態會是 [執行中]。

您也可以使用下列 Windows PowerShell Cmdlet 來啟動、停止和重新啟動虛擬裝置。每個 Cmdlet 都附有範例。

`Start-AzureVMC:\PS>Start-AzureVM -ServiceName "MyStorSimpleservice1" -Name "MyStorSimpleDevice"`
    

`Stop-AzureVMC:\PS>Stop-AzureVM -ServiceName "MyStorSimpleservice1" -Name "MyStorSimpleDevice"`

`Restart-AzureVMC:\PS>Restart-AzureVM -ServiceName "MyStorSimpleservice1" -Name "MyStorSimpleDevice"`

### 重設為原廠預設值

如果您決定要重新設定全新的虛擬裝置，請直接停用並加以刪除，然後建立新的虛擬裝置。和重設實體裝置的情況一樣，新的虛擬裝置將不會安裝任何更新，因此，請確實檢查有無更新，然後再開始使用它。


## 容錯移轉至虛擬裝置

災害復原 (DR) 是針對其設計 StorSimple 虛擬裝置的重要案例之一。在此案例中，實體 StorSimple 裝置或整個資料中心可能無法使用。幸運的是，您可以使用虛擬裝置，在替代位置中還原作業。在 DR 期間，來源裝置的磁碟區容器會變更擁有權，並移轉到虛擬裝置。DR 的必要條件是必須已建立並設定虛擬裝置、磁碟區容器內的所有磁碟區都要離線，以及磁碟區容器應該具有相關聯的雲端快照。

>[AZURE.NOTE]**您無法從執行 Update 1 的裝置容錯移轉或複製到執行更新前 1 軟體的裝置。如果您選取執行更新前 1 軟體的目標裝置，您將會收到通知，您必須更新執行容錯移轉之前的目標裝置。**

### 將實體裝置還原至 StorSimple 虛擬裝置

1. 確認您要容錯移轉的磁碟區容器是否具有相關聯的雲端快照。

- 開啟 [裝置] 頁面，然後按一下 [磁碟區容器] 索引標籤。

- 選取您要容錯移轉至虛擬裝置的磁碟區容器。按一下磁碟區容器，以顯示容器內的磁碟區清單。選取磁碟區，然後按一下 [離線]，使磁碟區離線。針對磁碟區容器中的所有磁碟區，重複執行這個程序。

- 針對您要容錯移轉至虛擬裝置的所有磁碟區容器，重複執行前一個步驟。

- 在 [裝置] 頁面上，選取您需要容錯移轉的 裝置，然後按一下 [容錯移轉]，以開啟 [裝置容錯移轉] 精靈。

- 在 [選擇要容錯移轉的磁碟區容器] 中，選取您要容錯移轉的磁碟區容器。若要顯示於此清單中，磁碟區容器必須包含雲端快照並離線。如果您預期看到的磁碟區容器並未出現，請取消精靈，並確認它是否離線。

- 在下一頁的 [為所選取容器中的磁碟區選擇目標裝置] 中，從可用裝置的下拉式清單中選取虛擬裝置。清單中只會顯示具有可用容量的裝置。

- 檢閱 [確認容錯移轉] 頁面上的所有容錯移轉設定。如果它們都正確，請按一下核取圖示。

容錯移轉程序就會開始。在容錯移轉完成後，移至 [裝置] 頁面，然後選取在容錯移轉程序中作為目標的虛擬裝置。移至 [磁碟區容器] 頁面。此時應會顯示所有磁碟區容器以及舊裝置中的磁碟區。

>[AZURE.NOTE]**虛擬裝置上支援的儲存體數量為 30 TB。**

## 關閉或刪除虛擬裝置

如果您先前已設定並使用 StorSimple 虛擬裝置，但現在不想再因為使用而產生計算費用，您可以關閉虛擬裝置。關閉虛擬裝置，並不會刪除其作業系統或儲存體中的資料磁碟。這只會停止您的訂用帳戶所產生的費用，但作業系統和資料磁碟的儲存體費用仍會繼續計算。

如果您刪除或關閉虛擬裝置，StorSimple Manager 服務的 [裝置] 頁面上會將其顯示為 [離線]。如果您也想要刪除虛擬裝置所建立的備份，可選擇以裝置的形式將其停用或刪除。如需詳細資訊，請參閱[停用](https://msdn.microsoft.com/library/33b7811b-36ba-4609-b165-0796ad456435#BKMK_acis_deactivate)。

### 關閉 StorSimple 虛擬裝置

1. 登入管理入口網站。

2. 按一下 [虛擬機器]，然後選取虛擬裝置。

3. 按一下 [關閉]。

### 刪除 StorSimple 虛擬裝置

1. 登入管理入口網站。

- 按一下 [虛擬機器]，然後選取虛擬裝置。

- 按一下 [**刪除**]，然後選擇刪除所有的虛擬機器磁碟。

## 後續步驟

了解如何[從備份集還原](../storsimple-restore-from-backupset.md)

<!---HONumber=July15_HO2-->