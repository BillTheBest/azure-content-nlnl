<properties 
    pageTitle="Azure SQL Database - 彈性資料庫工具" 
    description="使用彈性資料庫工具輕鬆縮放雲端的資料庫資源。" 
    services="sql-database" 
    documentationCenter="" 
    manager="jeffreyg" 
    authors="sidneyh" 
    editor=""/>

<tags 
    ms.service="sql-database" 
    ms.workload="sql-database" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="04/24/2015" 
    ms.author="sidneyh"/>

# Azure SQL Database - 彈性資料庫工具

## 承諾和挑戰

Azure SQL Database 提供幾乎無限制的資料庫資源，以及針對交易式工作負載的彈性。這項功能是由**彈性資料庫用戶端程式庫**和**分割合併工具** (合稱為**彈性資料庫工具**) 等功能所促成。這些元件是設計來簡化開發和管理分區化資料庫解決方案 – 在這篇文章中討論。

雖然已簡單達成雲端應用程式在計算和 blob 儲存體方面的彈性和縮放，但仍有待克服關聯式資料庫中的可設定狀態資料處理。我們已知這些挑戰最主要出現在下列兩個案例中：

* 針對工作負載的關聯式資料庫部分放大和縮小容量。
* 管理可能會影響特定資料子集的作用點 - 例如特別忙碌的終端客戶 (租用戶)。

傳統上，要解決這類情況，都是經由投資更大型的資料庫伺服器來支援應用程式。不過，此選項在雲端有其限制，因為所有處理都發生在預先定義的商用硬體上。相反地，將資料和處理分散至許多相容結構的資料庫 (一種稱為分區化的相應放大模式)，不論在成本或彈性上，都是超越傳統相應增加方法的另一種強大的選擇。

Azure SQL Database 的彈性資料庫功能比以往更簡單且更有彈性地相應放大。如果您正在開發軟體即服務應用程式，**彈性資料庫集區**可讓您輕鬆為每個終端客戶或租用戶建立個別的資料庫，並讓每個資料庫動態地自動擴大或縮小其資料使用量，同時將預算控制在可預測的範圍內。**彈性資料庫作業**可讓您以一整組資料庫的規模來可靠地執行管理作業，您可以執行 T-SQL 指令碼來結構描述變更、認證管理，或您選擇的其他任何資料庫維護作業。如需彈性資料庫工作的詳細資訊，請參閱[彈性資料庫工作概觀](sql-database-elastic-jobs-overview.md)。

不論您對每個租用戶使用不同的資料庫，或將多個範圍的資料壓縮到資料庫集合中的每一個資料庫，彈性資料庫用戶端程式庫和分割/合併工具都可降低建置和管理利用分區化的應用程式所需的工作量。用戶端程式庫可讓您專注於應用程式的商務邏輯，而不必撰寫程式碼來記錄所有資料庫上的資料配置，以及將連線遞送到正確的位置。

## 水平和垂直縮放
下圖顯示縮放的水平和垂直面向。
 
![水平與垂直相應放大][4]

水平縮放是指加入或移除資料庫來調整容量或整體效能。這通常稱為「相應放大」。分區化是常用的水平縮放方法，主要是將資料分割到結構相同的一組資料庫上。

垂直縮放是指增加或減少個別資料庫的效能層級 – 也稱為「相應增加」。

大部分雲端級別的資料庫應用程式都採用這些兩種策略的組合。比方說，軟體即服務應用程式可能使用水平擴充來供應終端客戶，使用垂直縮放來允許每個終端客戶的資料庫隨工作負載所需而擴大或縮減資源。

彈性資料庫工具可簡化建置依賴分區化的應用程式 – 處理水平縮放基礎結構。對您資料庫系列使用彈性資料庫集區時，系統會自動處理垂直縮放。使用集區時，您必須負責設定整體系統的限制，以及允許每個資料庫變動的範圍。您也可以手動變更不參與彈性資料庫集區的資料庫版本或資料庫的資源層級。例如，您可以建立新的分區來處理月底大量湧入的資料。當新資料送達時，分區會向上調整，並隨著流入的資料減少而向下調整。

如需彈性資料庫集區的詳細資訊，請參閱[彈性資料庫集區概觀](sql-database-elastic-pool.md)。

## 彈性資料庫工具功能 

使用分區化來開發、縮放和管理相應放大應用程式，對開發人員和系統管理員而言都是一項挑戰。彈性資料庫工具讓這兩個角色工作的更輕鬆。下圖中的數字指出彈性資料庫用戶端程式庫和分割合併工具所提供的主要功能。圖中顯示一個具有許多資料庫的環境，而每個資料庫對應至一個分區。這些工具透過下列特定功能，讓開發分區化 Azure SQL DB 應用程式變得更輕鬆：

關於本文使用的詞彙定義，請參閱[彈性資料庫工具字彙](sql-database-elastic-scale-glossary.md)。

![彈性擴縮功能][1]

1.  **分區對應管理**：分區對應管理可讓應用程式管理其分區的各種中繼資料。分區對應管理是彈性資料庫用戶端程式庫的一項功能。開發人員可利用此功能將資料庫註冊為分區 (描述個別分區化索引鍵或索引鍵範圍至這些資料庫的對應)，並隨著資料庫的數量和組成發展來維護此中繼資料，以反映容量變更。分區對應管理構成樣板程式碼的一大部分，客戶在自行實作分區化時必須在應用程式中撰寫這些程式碼。如需詳細資訊，請參閱[分區對應管理](sql-database-elastic-scale-shard-map-management.md)。
 
* **資料相依路由**：想像有一個要求進入應用程式。應用程式必須根據要求的分區化索引鍵值，判斷哪個資料庫中有這個索引鍵值的資料，然後對此它開啟連接來處理要求。資料相依路由可讓您輕鬆地呼叫一次應用程式的分區對應，就能開啟連接。資料相依路由是基礎結構程式碼的另一個領域，現在由彈性資料庫用戶端程式庫中的功能所涵蓋。如需詳細資訊，請參閱[資料相依路由](sql-database-elastic-scale-data-dependent-routing.md)。

* **多分區查詢 (MSQ)**：當要求牽涉到數個 (或所有) 分區時，多分區查詢就派上用場。多分區查詢在所有分區或一組分區上執行相同的 T-SQL 程式碼。使用 UNION ALL 語意可將參與分區的結果合併成整體的結果集。經由用戶端程式庫公開的功能可處理許多工作，包括：連接管理、執行緒管理、錯誤處理和中繼結果處理。MSQ 可以查詢多達數百個分區。如需詳細資訊，請參閱[多分區查詢](sql-database-elastic-scale-multishard-querying.md)。


* **分割合併工具**：如果您選擇不使用簡單的模型在彈性資料庫集區中配置不同資料庫給每個 Shardlet (租用戶)，當容量需求隨著商務趨勢而波動時，您的應用程式可能需要靈活地在資料庫之間重新分配資料。彈性資料庫工具包含客戶裝載的分割合併工具，在同時牽涉到資料移動的情況下，可重新平衡資料分佈及管理分區化應用程式的作用區。它根據一項基礎功能，可在不同資料庫之間隨需求移動 Shardlet，並與分區對應管理整合來維持一致的對應和正確的資料相依路由連接。如需詳細資訊，請參閱[使用彈性資料庫工具來分割及合併](sql-database-elastic-scale-overview-split-and-merge.md)。

一般而言，使用彈性資料庫工具的客戶在提交分區內作業，而不是有其本身語意的跨分區作業時，就可以獲得完整的 T-SQL 功能。

## 常見的分區化模式

**分區化**是一種將大量相同結構的資料分散在許多獨立資料庫的技術。為一般客戶或企業建立軟體即服務 (SAAS) 供應項目的開發人員尤其愛用。這些一般客戶通常稱為「租用戶」。需要使用分區化可能有各種原因：

* 資料總量太大而超出單一資料庫的條件約束 
* 整體工作負載的交易輸送量超過單一資料庫的能力 
* 租用戶可能需要彼此實際隔離，因此每個租用戶需要個別的資料庫 
* 基於規範、效能或地理政治的理由，資料庫的不同區段可能需要位於不同的地理位置。 

在其他情況下，例如從分散式裝置擷取資料，分區化可用於填滿一組暫時組織的資料庫。例如，一個不同的資料庫可專供每日或每週使用。在此情況下，分區化索引鍵可以是表示日期的整數 (出現在分區化資料表的所有資料列)，而擷取日期範圍資訊的查詢，必須由應用程式遞送至涵蓋相關範圍的資料庫子集。
 
當應用程式中的每一筆交易可以限制為單一分區化索引鍵的單一值時，分區化表現最佳。這可確保所有交易都在特定資料庫的範圍內發生。

有些應用程式採用最簡單的方法，為每個租用戶建立個別的資料庫。這就是**單一租用戶分區化模式**，在租用戶的細微層級上提供隔離、備份/還原能力和資源縮放。使用單一租用戶分區化時，每個資料庫與特定的租用戶識別碼值 (或客戶索引鍵值) 相關聯，但該索引鍵不一定出現在資料本身。應用程式必須負責將每個要求遞送至適當的資料庫 - 彈性資料庫用戶端程式庫可以簡化此工作。

![單一租用戶與多租用戶][3]

其他案例將多個租用戶一起放入資料庫中，而不是將它們隔離至個別的資料庫。這就是一般的**多租用戶分區化模式** – 可能是因為應用程式管理大量非常小的租用戶。在多租用戶分區化中，資料庫資料表中的資料列都設計成具有索引鍵 (識別租用戶識別碼) 或分區化索引鍵。同樣地，應用程式層負責將租用戶的要求遞送至適當的資料庫，而彈性資料庫用戶端程式庫支援此功能。此外，資料列層級安全性可用於篩選每個租用戶可以存取的資料列 – 如需詳細資訊，請參閱[使用彈性資料庫工具和資料列層級安全性的多租用戶應用程式](sql-database-elastic-tools-multi-tenant-row-level-security.md)。多租用戶分區化模式可能需要在資料庫之間重新分配資料，而彈性資料庫分割合併工具可協助達成此工作。

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]: ./media/sql-database-elastic-scale-introduction/overview.png
[2]: ./media/sql-database-elastic-scale-intro/tenancy.png
[3]: ./media/sql-database-elastic-scale-introduction/single_v_multi_tenant.png
[4]: ./media/sql-database-elastic-scale-introduction/h_versus_vert.png
 

<!---HONumber=July15_HO2-->